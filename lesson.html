<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson View - LearningTime VR Support</title>
    <!-- <link rel="stylesheet" href="style.css"> --> <!-- Commented out old link -->
    <link rel="stylesheet" href="css/support-style.css"> <!-- Removed ../ -->
    <link rel="icon" type="image/png" href="assets/Favicon.png"> <!-- Added Favicon -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <style>
        /* Add specific styles for lesson view if needed */
        .lesson-container {
            display: flex;
        }
        .sidebar {
            width: 250px;
            border-right: 1px solid #eee;
            padding-right: 20px;
            margin-right: 20px;
        }
        .sidebar h2 {
            font-size: 1.2em;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar li a {
            display: block;
            padding: 10px 0;
            text-decoration: none;
            color: #333;
            /* Add active state styling */
        }
        .sidebar li a:hover {
            color: #007bff; /* Example hover color */
        }
        .lesson-content {
            flex-grow: 1;
        }
        .next-btn {
            display: flex;
            /* align-items: center; removed for fine-tuning */
            justify-content: center;
            height: 44px;
            padding: 0 20px;
            background: linear-gradient(to right, #0052cc, #007bff);
            color: white;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            font-weight: normal;
            text-decoration: none;
            text-align: center;
            box-sizing: border-box;
            line-height: 44px;
            margin-bottom: 1px;
            margin-top: 3px;
        }
        .next-btn .btn-text {
            display: inline-block;
            width: 100%;
        }
        .nav-button-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            margin-bottom: 180px;
            min-height: 44px;
        }
        .back-link {
             text-decoration: none;
             color: #007bff;
             display: flex;
             align-items: center;
             justify-content: center;
             height: 44px;
             padding: 0 10px;
             font-size: 16px;
             font-family: inherit;
             font-weight: normal;
             margin: 0;
             box-sizing: border-box;
             line-height: normal;
        }
        .back-link:hover {
             text-decoration: underline;
        }

        /* Styling for the clickable sidebar topic */
        a.sidebar-topic-link {
            text-decoration: none; /* Remove underline */
            color: inherit; /* Use default text color */
            display: block; /* Make the link take up the h2's block space */
            cursor: pointer; /* Indicate clickability */
            border-bottom: 1px solid #eee; /* Keep the original h2 border */
            margin-bottom: 15px; /* Keep the original h2 margin */
            padding-bottom: 10px; /* Keep the original h2 padding */
        }
        a.sidebar-topic-link h2 {
            margin: 0; /* Remove default h2 margin as it's on the link */
            padding: 0; /* Remove default h2 padding */
            border: none; /* Remove default h2 border */
            font-size: 1.2em; /* Keep original h2 font-size */
            /* Inherit color and font-weight from parent link/h2 defaults */
        }
        a.sidebar-topic-link:hover h2 {
             color: #007bff; /* Example hover color, same as lesson links */
        }
    </style>
</head>
<body>
    <!-- Header will be dynamically injected by header.js -->

    <main class="container lesson-container">
        <aside class="sidebar">
            <a href="#" id="sidebar-topic-link" class="sidebar-topic-link">
                <h2 id="sidebar-topic">Topic</h2>
            </a>
            <ul id="sidebar-nav">
                <!-- Sidebar links will be populated by JS -->
                 <!-- Static links removed -->
            </ul>
        </aside>
        <section class="lesson-content">
            <h1 id="lesson-title">Lesson Title</h1>
            <div id="lesson-body">
                <!-- Lesson content will be loaded here -->
                <p>This is placeholder content for the lesson. It will be replaced dynamically or built out later.</p>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quod, quidem asperiores? Voluptates, quasi! Quisquam, quod.</p>
            </div>
            <div style="clear:both;"></div>
        </section>
    </main>
<div class="container nav-section-wrapper" style="padding-bottom: 10px;">
    <hr style="border: 0; border-top: 1px solid #eee;">
    <div class="nav-button-container">
         <a href="support.html" class="back-link"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="vertical-align: middle; margin-right: 4px;" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>Back to Support Home</a>
         <a href="#" id="next-lesson-btn" class="next-btn"><span class="btn-text">Next Section →</span></a>
    </div>
</div>
<div id="footer-placeholder"></div>
    <!-- Calendly script needed if header button is clicked from this page -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
    <script src="js/script.js"></script>
    <script src="js/footer.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendlyUrl = 'https://calendly.com/learningtimevr-demo/30min';

            // --- Lesson Data Structure ---
            const lessonsData = {
                'start-here': {
                    name: 'Start Here',
                    lessons: [
                        { id: 'start-here-overview', title: 'Start Here', isOverview: true, content: '<p>Welcome to LearningTime VR! This getting started course is designed to help you and your students get up and running with your virtual reality headsets in no time. We\'re thrilled to guide you through this process and make it as easy and enjoyable as possible.</p><p>Here\'s what you\'ll accomplish with this guide:</p><ol><li>Get the basics down with the Quick Start Guide.</li><li>Learn about ArborXR for managing your headsets.</li><li>Plan your classroom space for VR activities.</li><li>Review key safety guidelines.</li><li>Explore accessibility options.</li></ol><p>Let\'s get started!</p>' },
                        { id: 'quick-start', title: 'Quick Start Guide for First-Time Users', content: '<ol><li><strong>Headset Tour</strong>: Check out this <a href="headset-tour.html">headset tour video</a> to learn how to handle your headsets.</li><li><strong>Learn the Controls</strong>:<ul><li>Power Button: Hold the side button for 3 seconds to turn the headset on or off.</li><li>Controllers: Use the joysticks to move around menus and select options.</li><li>Getting Started Presentation: <div style="position: relative; width: 100%; padding-top: 56.25%; margin: 20px 0;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" src="https://docs.google.com/presentation/d/1UioC-VhXCc7sm5Oni4GiElR-Ejh6UDhIIkhwYphLmjc/embed?start=false&loop=false&delayms=3000" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div></li></ul></li><li><strong>Put On the Headset</strong>: Adjust the size for a snug fit and clear view.</li><li><strong>Look at the Menu</strong>: Turn on the headset and explore the available apps.</li><li><strong>Test The App You Want to Use</strong>: Pick an app or experience that fits your lesson.</li><li><strong>Distribute the Headsets</strong>: Hand them out to students seated at their desks.</li><li><strong>Screen Mirror with ArborXR</strong>: Monitor student screens using ArborXR. <a href="lesson.html?topic=setup-class-management&lesson=view-screens">Learn how to view student screens</a>.</li></ol><p>That\'s it—you\'re ready to roll!</p>' },
                        { id: 'arborxr-intro', title: 'ArborXR Introduction', content: '<h3>What is ArborXR and why do we use it?</h3><p>ArborXR is our go-to platform for managing your VR headsets. It hosts content, lets you control what shows up on student menus, and allows you to launch apps and view student screens—all from one place. It\'s your classroom command center!</p><h3>Getting Started:</h3><p>Learn the basics of using ArborXR:</p><div style="position: relative; width: 100%; padding-top: 56.25%; margin: 20px 0;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" src="https://docs.google.com/presentation/d/1UioC-VhXCc7sm5Oni4GiElR-Ejh6UDhIIkhwYphLmjc/embed?start=false&loop=false&delayms=3000" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div><p>For more detailed information and troubleshooting guides, visit the <a href="https://help.arborxr.com/en/" target="_blank">ArborXR Help Center</a>.</p><p>If you do not have a login for ArborXR, please reach out to <a href="mailto:nick@learningtimevr.com">nick@learningtimevr.com</a> to get set up.</p>' },
                        { id: 'space-planning', title: 'Classroom Space Planning', content: '<p>Here\'s how we recommend you set up your classroom for a smooth VR experience:</p><ul><li><strong>Seated Use</strong>: Have students use the headsets at their desks, with the cases right in front of them.</li><li><strong>Standing Use</strong>: If students stand, give each at least 6.5 ft x 6.5 ft of clear space to avoid bumping into others or walls.</li><li><strong>Virtual Boundaries</strong>: The Pico 4E sets these up automatically. If a student steps out, it switches to pass-through mode (showing the real world), and they might need to reset the boundary.</li></ul><p>Keep it simple and safe!</p>' },
                        { id: 'safety', title: 'Safety Guidelines & Best Practices', content: '<p>Safety first! Here are the key guideline to keep your VR lessons worry-free:</p><ul><li><strong>Take Breaks</strong>: Give students a breather between VR experiences.</li><li><strong>Spatial Awareness</strong>: Remind them to stay aware of their surroundings, especially if standing.</li><li><strong>Seated vs. Standing</strong>: Seated use is best for most activities.</li><li><strong>Motion Sickness</strong>: If a student feels dizzy, have them take a break right away.</li><li><strong>Eye Strain</strong>: Tell them to rest their eyes if they feel discomfort.</li></ul><p>That\'s all you need to keep things running smoothly.</p>' },
                        { id: 'student-intro-pres', title: 'Student Introduction Presentation', content: '<p>Prepare your students for their first VR experience with this introduction presentation:</p><div style="position: relative; width: 100%; padding-top: 56.25%; margin: 20px 0;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" src="https://docs.google.com/presentation/d/1jXYUXf-meyHKsK3mvgU8IkY83-fRvG_P95d8a9wUzJs/embed?start=false&loop=false&delayms=3000" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe></div>' },
                        { id: 'accessibility', title: 'Accessibility Features & Accommodations', content: '<p>We want everyone to enjoy LearningTime VR! Many Victory XR experiences are available on desktop for students who need alternatives to headsets. Check out the full list of desktop-accessible content at <a href="https://vxrweb.victoryxr.com/dashboard" target="_blank">Victory XR Desktop Experiences</a>.</p><p>To access Victory XR on desktop, use the following login credentials:</p><ul><li><strong>Username</strong>: S[headset number]@learningtimevr.com</li><li><strong>Password</strong>: 12345678</li></ul><p>Replace [headset number] with the number of the headset you are using.</p>' }
                    ]
                },
                'setup-class-management': {
                    name: 'Set Up & Class Management',
                    lessons: [
                        { id: 'setup-overview', title: 'Set Up & Class Management', isOverview: true, content: '<p>This section covers the practical aspects of integrating VR into your classroom routines and managing student use.</p><ul><li>Plan VR session timing and scheduling.</li><li>Implement effective classroom management strategies for VR.</li><li>Learn how to view student screens.</li><li>Handle common technical hiccups during class.</li><li>Maintain headset hygiene.</li><li>Properly store equipment.</li></ul>' },
                        { id: 'class-strategies', title: 'Classroom Management Strategies', content: '<p>Here\'s how to manage using VR into your classroom like a pro.</p><h3>Scheduling & Time Management</h3><ul><li>Timing: Plan for 10-15 minutes to hand out headsets and another 10-15 to pack them up.</li><li>Breaks: Let students rest between VR experiences.</li><li>Discussion: Wrap up with a quick class chat about what they learned.</li><li>Launching Apps: Use ArborXR to pick a headset and start the right app—see the documentation here (#). (Link to be added)</li></ul>' },
                        { id: 'view-screens', title: 'View Student Screens', content: '<p>With Remote View, you can cast the device\'s output to the ArborXR Web Portal over Wi-Fi. This functionality is crucial for guiding users through VR experiences, as well as providing remote support and troubleshooting.</p><h3>How to Cast Multiple Devices</h3><ol><li>Navigate to <strong>Groups</strong> in the side navigation menu.</li><li>Select the Group in question.</li><li>Select one or multiple devices.</li><li>Click <strong>Actions</strong>.</li><li>Click <strong>Cast Devices</strong>.</li></ol><p>On certain devices, such as Meta Quest, PICO 4 Enterprise, VIVE Focus 3, and tablets, a system dialog will open prompting users for permission to cast. Users must select <strong>Start Now</strong> or <strong>Allow</strong>.</p><p>⚠️ If users select Cancel or Don\'t Allow, the device must be rebooted and device casting via the ArborXR web portal must be re-initiated for this dialog to open once more.</p><h3>How to Cast a Single Device</h3><ol><li>Navigate to <strong>Devices</strong> in the side navigation menu.</li><li>Select the device in question.</li><li>Click <strong>Cast Device</strong>.</li></ol><p>💡 Remotely launching content, be it an app, video, or WebXR link, is a feature that goes hand in hand with Remote View. To that end, we\'ve conveniently included a <strong>Launch Content</strong> button directly in the cast view.</p><p><a href="https://help.arborxr.com/en/articles/8029027-remote-view" target="_blank">View the original ArborXR Remote View documentation →</a></p>' },
                        { id: 'technical-issues', title: 'Handling Technical Issues', content: '<p><strong>Controllers Not Working?</strong>: Check the batteries—cases come with rechargeable ones.</p><p><strong>Restarting</strong>: Hold the power button for 10 seconds or reboot via ArborXR.</p><p><strong>Still Stuck?</strong>: Email <a href="mailto:nick@learningtimevr.com">nick@learningtimevr.com</a> for help.</p>' },
                        { id: 'cleaning', title: 'Cleaning Your Headsets', content: '<p>Keep things fresh and clean:</p><ul><li><strong>Face Pad & Controllers</strong>: Wipe with Clorox wipes or similar after each use.</li><li><strong>Lenses</strong>: Use a microfiber cloth to gently clean. <strong>⚠️ Do not use Clorox wipes on the lenses</strong> as they can damage the lens coating.</li></ul><p>Clean after every class—it\'s quick with student help and keeps everyone healthy!</p><div style="margin-top: 20px;"><img src="assets/Headset Cleaning.png" alt="Headset cleaning instructions" style="max-width: 100%; height: auto;"></div>' },
                        { id: 'storage', title: 'Putting Headsets Away', content: '<p><strong>Turn Off</strong>: Press the power button (they\'ll auto-shutdown, but this is best).</p><p><strong>Plug In</strong>: Connect headsets to their cases, then plug the cases into the wall overnight for charging and updates.</p><p><strong>Storage</strong>: See how they fit in the image below.</p><div style="margin-top: 20px;"><img src="assets/Headset Storage.png" alt="Headset storage instructions" style="max-width: 100%; height: auto;"></div>' }
                    ]
                },
                'content-library': {
                    name: 'Content Library',
                    lessons: [
                        { id: 'content-overview', title: 'Content Library', isOverview: true, content: '<p>Explore the available learning applications and content for your LearningTime VR system.</p><ul><li>Managing content via ArborXR.</li><li>Discovering VXR Labs experiences.</li><li>How to request new content titles.</li></ul>' },
                        { id: 'arborxr-content', title: 'ArborXR', content: '<p>Apps Available: See all loaded apps—like Career Exploration and Victory XR experiences—inside ArborXR.</p><div style="position: relative; width: 100%; padding-top: 75%; margin: 20px 0;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" src="https://docs.google.com/spreadsheets/d/1HWmpPGHEWJuNonZ9LJKx-wDP6OQq6PWvSsnV0kdfluc/edit?usp=sharing&embedded=true" frameborder="0"></iframe></div><p style="margin-top: 20px;"><a href="lesson.html?topic=start-here&lesson=arborxr-intro">Learn how to use ArborXR →</a></p>' },
                        { id: 'vxr-labs', title: 'VXR Labs', content: '<p>VXR Labs brings interactive science to life with virtual experiments and simulations.</p><div style="position: relative; width: 100%; padding-top: 75%; margin: 20px 0;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" src="https://docs.google.com/spreadsheets/d/1EMeurtZypbycTYlQFWll6A53Zl3ci9sYvoP46ed7rww/edit?usp=sharing&embedded=true" frameborder="0"></iframe></div><h3>Login Information</h3><ul><li><strong>Username</strong>: S[headset number]@learningtimevr.com</li><li><strong>Password</strong>: 12345678</li></ul><p>Replace [headset number] with the number of the headset you are using.</p><p style="margin-top: 20px;">Note: Some experiences are only available on Quest 2 and Quest 3 headsets.</p>' },
                        { id: 'request-content', title: 'Request New Content', content: '<p>Want something new? Email <a href="mailto:nick@learningtimevr.com">nick@learningtimevr.com</a> with:</p><ul><li>Subject matter you\'d like.</li><li>Learning objectives.</li><li>Feedback on current content.</li></ul>' }
                    ]
                },
                'troubleshooting-support': {
                    name: 'Troubleshooting & Support',
                    lessons: [
                        { id: 'support-overview', title: 'Troubleshooting & Support', isOverview: true, content: '<p>Find solutions to common problems and learn how to get help when needed.</p><ul><li>Addressing common technical issues.</li><li>Keeping software up-to-date.</li><li>Understanding warranty coverage.</li></ul>' },
                        { id: 'common-issues', title: 'Common Issues & Solutions', content: '<p><strong>Controller Issues</strong>: Usually a battery problem—recharge or replace.</p><p><strong>Visual Glitches</strong>: Reboot by holding the power button for 10 seconds.</p><p><strong>Still Need Help?</strong>: Email <a href="mailto:nick@learningtimevr.com">nick@learningtimevr.com</a>.</p>' },
                        { id: 'software-updates', title: 'Software Updates', content: '<p>Keep headsets plugged in and online—ArborXR will handle updates overnight automatically.</p>' },
                        { id: 'warranty', title: 'Warranty Information', content: '<p>The Pico 4E comes with a limited warranty that covers manufacturing defects and malfunctions. Here are the key details:</p><h3>Warranty Period</h3><p>The warranty is valid for:</p><ul><li>One (1) year from the date of purchase or delivery (whichever is later)</li></ul><h3>What\'s Not Covered</h3><ul><li><strong>Improper Use</strong>: Damage from improper usage or maintenance not included in the manual</li><li><strong>Environmental Damage</strong>: Use outdoors, exposure to liquids, sunlight, extreme conditions</li><li><strong>Screen Damage</strong>: Damage caused by sunlight, UV light, or other strong light sources</li><li><strong>Normal Wear</strong>: Deterioration of cosmetic appearance due to normal use</li><li><strong>Consumable Parts</strong>: Including face cushions, headbands, mounting kits, etc.</li><li><strong>Unauthorized Repairs</strong>: Damage from unauthorized modifications or repairs</li><li><strong>Force Majeure</strong>: Damage from fire, flood, lightning, etc.</li></ul><p>For complete warranty details and terms, visit the <a href="https://www.picoxr.com/global/legal/limited-warranty" target="_blank">Pico Limited Warranty Page →</a></p>' }
                    ]
                }
            };

            // Define the order of topics for navigation
            const topicOrder = ['start-here', 'setup-class-management', 'content-library', 'troubleshooting-support'];

            // --- Elements ---
            const sidebarNav = document.getElementById('sidebar-nav');
            const sidebarTopicEl = document.getElementById('sidebar-topic');
            const lessonTitleEl = document.getElementById('lesson-title');
            const lessonBodyEl = document.getElementById('lesson-body');
            const nextBtn = document.getElementById('next-lesson-btn');
            const scheduleHeaderBtn = document.getElementById('schedule-header-btn');
            const sidebarTopicLink = document.getElementById('sidebar-topic-link');

            // --- Calendly --- (Keep existing logic)
            function openCalendly(url) {
                Calendly.initPopupWidget({ url: url });
                return false;
            }
            if (scheduleHeaderBtn) {
                scheduleHeaderBtn.addEventListener('click', () => openCalendly(calendlyUrl));
            }

            // --- Lesson Loading and Sidebar Population ---
            const urlParams = new URLSearchParams(window.location.search);
            const currentTopicId = urlParams.get('topic') || topicOrder[0]; // Default to first topic
            const requestedLessonId = urlParams.get('lesson'); // Get requested lesson ID
            const currentTopicData = lessonsData[currentTopicId];
            let currentLessonIndex = 0; // Initialize

            // Find the index of the requested lesson ID
            if (requestedLessonId && currentTopicData) {
                const foundIndex = currentTopicData.lessons.findIndex(l => l.id === requestedLessonId);
                if (foundIndex !== -1) {
                    currentLessonIndex = foundIndex;
                }
            }

            function loadLesson(lessonIndex) {
                if (!currentTopicData || !currentTopicData.lessons[lessonIndex]) return;

                const lesson = currentTopicData.lessons[lessonIndex];
                lessonTitleEl.textContent = lesson.title;

                // Handle overview pages
                if (lesson.isOverview) {
                    // Use content defined in lessonsData for overview
                    lessonBodyEl.innerHTML = lesson.content || `<p>Overview of the <strong>${currentTopicData.name}</strong> section. Select a lesson from the sidebar to get started.</p>`; // Fallback if content is missing
                } else {
                    // Use content defined in lessonsData for regular lessons
                    lessonBodyEl.innerHTML = lesson.content || `<p>Content for <strong>${lesson.title}</strong> goes here. This is a placeholder.</p>`; // Fallback if content is missing
                }

                currentLessonIndex = lessonIndex;

                // Update active state in sidebar
                const sidebarLinks = document.querySelectorAll('#sidebar-nav li a');
                sidebarLinks.forEach((link, sidebarIndex) => {
                    if (lesson.isOverview) {
                        // If showing overview, no sidebar link should be active
                        link.classList.remove('active');
                    } else {
                        // If showing a real lesson, activate the corresponding sidebar link
                        // The sidebar index is lessonIndex - 1 because the overview is skipped
                        link.classList.toggle('active', sidebarIndex === lessonIndex - 1);
                    }
                });

                // --- Update Next button state and text ---
                const isLastLesson = lessonIndex >= currentTopicData.lessons.length - 1;
                const currentTopicOrderIndex = topicOrder.indexOf(currentTopicId);
                const isLastTopic = currentTopicOrderIndex >= topicOrder.length - 1;

                if (isLastLesson) {
                    if (isLastTopic) {
                        nextBtn.style.display = 'none'; // Hide on last lesson of last topic
                    } else {
                        // Show "Next Topic" button
                        const nextTopicId = topicOrder[currentTopicOrderIndex + 1];
                        const nextTopicName = lessonsData[nextTopicId]?.name || 'Next Topic';
                        nextBtn.textContent = `Next Topic: ${nextTopicName} →`;
                        nextBtn.style.display = 'inline-block';
                        nextBtn.setAttribute('data-action', 'next-topic'); // Mark action type
                        nextBtn.setAttribute('data-next-topic', nextTopicId); // Store next topic id
                    }
                } else {
                    // Show "Next Section" button
                    nextBtn.textContent = 'Next Section →';
                    nextBtn.style.display = 'inline-block';
                     nextBtn.setAttribute('data-action', 'next-section'); // Mark action type
                     nextBtn.removeAttribute('data-next-topic');
                }
            }

            function populateSidebar() {
                if (!currentTopicData) {
                    sidebarTopicEl.textContent = 'Unknown Topic';
                    lessonTitleEl.textContent = 'Content not found';
                    lessonBodyEl.innerHTML = '<p>Please select a topic from the Support Home page.</p>';
                    sidebarNav.innerHTML = '';
                     nextBtn.style.display = 'none';
                    return;
                }

                sidebarTopicEl.textContent = currentTopicData.name;
                sidebarNav.innerHTML = ''; // Clear existing static or old items

                currentTopicData.lessons.forEach((lesson, index) => {
                    // Skip creating a sidebar link for the overview page itself
                    if (lesson.isOverview) {
                        return; // Skip this iteration
                    }

                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = `#${lesson.id}`; // Use hash for potential deep linking / identification
                    a.textContent = lesson.title;
                    a.addEventListener('click', (e) => {
                        e.preventDefault(); // Prevent page jump
                        loadLesson(index);
                    });
                    li.appendChild(a);
                    sidebarNav.appendChild(li);
                });

                // Load the initially determined lesson (from URL or default)
                loadLesson(currentLessonIndex);
            }

            // --- Next Button Logic ---
            if(nextBtn) {
                nextBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = nextBtn.getAttribute('data-action');

                    if (action === 'next-section') {
                        const nextLessonDataIndex = currentLessonIndex + 1;
                        if (currentTopicData && nextLessonDataIndex < currentTopicData.lessons.length) {
                            // The sidebar link to click corresponds to the *current* lesson index
                            // because the sidebar link list is 1 shorter than the lessons list (due to skipping the overview)
                            // When currentLessonIndex is 0 (overview), we click sidebar link 0.
                            // When currentLessonIndex is 1 (first real lesson), we click sidebar link 1, etc.
                            const nextSidebarLinkIndex = currentLessonIndex;
                            const nextLink = sidebarNav.querySelectorAll('li a')[nextSidebarLinkIndex];
                            if (nextLink) {
                                nextLink.click();
                            } else {
                                console.error("Could not find next sidebar link at index:", nextSidebarLinkIndex);
                            }
                        }
                    } else if (action === 'next-topic') {
                        const nextTopicId = nextBtn.getAttribute('data-next-topic');
                        if (nextTopicId) {
                            window.location.href = `lesson.html?topic=${nextTopicId}`;
                        }
                    }
                });
            }

            // --- Sidebar Topic Link --- Add listener for the topic link
            if (sidebarTopicLink) {
                sidebarTopicLink.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent default anchor behavior
                    loadLesson(0); // Load the overview page (index 0)
                });
            }

            // --- Initial Load ---
            populateSidebar();

        });
    </script>
    <script>
        // Update copyright year automatically
        // Need to run this after DOM is loaded, but the script is already inside a DOMContentLoaded listener
        // However, it's safer to put this specific update outside that listener, at the end of the body.
        document.getElementById("copyright-year").textContent = new Date().getFullYear();
    </script>
    <script src="js/header.js"></script>
</body>
</html> 